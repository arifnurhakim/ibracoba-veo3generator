<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veo 3 Prompt Generator (Lengkap)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 1.5rem;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        input, select, textarea {
            border-radius: 8px;
            border: 1px solid #d1d5db;
            padding: 0.75rem 1rem;
            width: 100%;
            transition: all 0.2s ease-in-out;
            outline: none;
            color: #374151;
        }
        textarea {
            resize: vertical;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.25);
        }
        button {
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .btn-primary { background-color: #6366f1; color: #ffffff; }
        .btn-primary:hover:not(:disabled) { background-color: #4f46e5; }
        .btn-primary:disabled { background-color: #a5b4fc; cursor: not-allowed; }
        .btn-secondary { background-color: #e5e7eb; color: #374151; }
        .btn-secondary:hover { background-color: #d1d5db; }
        .btn-danger { background-color: #ef4444; color: #ffffff; }
        .btn-danger:hover { background-color: #dc2626; }
        textarea.prompt-output {
            min-height: 150px;
            background-color: #f9fafb;
            color: #1f2937;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        .section-title { @apply text-xl font-semibold text-gray-800 mt-8 mb-4 border-b pb-2 border-gray-200; }
        .character-block, .scene-block { @apply bg-gray-50 p-4 rounded-lg mb-4 border border-gray-200; }
        .dialog-content-block { @apply bg-blue-50 p-3 rounded-lg mt-2 mb-2 border border-blue-200; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); display: flex; justify-content: center; align-items: center; }
        .modal-content { background-color: #fefefe; margin: auto; padding: 20px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); width: 80%; max-width: 400px; text-align: center; }
        .close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; }
        .close-button:hover, .close-button:focus { color: black; text-decoration: none; cursor: pointer; }
        .loader { border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #6366f1; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="p-4">
    <div class="container">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">Veo 3 Prompt Generator (Lengkap)</h1>
        <p class="text-center text-red-500 text-sm mb-6">
            APLIKASI INI DIBUAT OLEH <span class="font-bold">Papahnya Ibracobra</span>
        </p>

        <div class="mb-6 bg-purple-50 border border-purple-200 p-4 rounded-lg">
            <label for="apiKeyInput" class="block text-gray-800 text-sm font-medium mb-2">Google AI API Key Anda:</label>
            <input type="password" id="apiKeyInput" placeholder="Masukkan Google AI API Key Anda" class="w-full">
            <p class="text-xs text-gray-500 mt-1">Dapatkan kunci dari <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-indigo-600 hover:underline">Google AI Studio</a>. Kunci tidak disimpan dan hanya digunakan di browser Anda.</p>
        </div>
        
        <h2 class="section-title">Opsi 1: Hasilkan Deskripsi dari Gambar</h2>
        <div class="bg-gray-50 p-4 rounded-lg mb-8 border border-gray-200">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="imageUpload" class="block text-gray-700 text-sm font-medium mb-2">Unggah Gambar:</label>
                    <input type="file" id="imageUpload" accept="image/*" class="block w-full text-sm text-gray-900 bg-white rounded-lg border border-gray-300 cursor-pointer focus:outline-none p-2 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                </div>
                <div>
                    <label for="imageTarget" class="block text-gray-700 text-sm font-medium mb-2">Pilih Target Deskripsi:</label>
                    <select id="imageTarget"></select>
                </div>
            </div>
             <div id="image-preview-container" class="mt-4 hidden text-center">
                <p class="text-sm font-medium text-gray-700 mb-2">Pratinjau Gambar:</p>
                <img id="imagePreview" src="#" alt="Pratinjau Gambar" class="max-h-48 rounded-lg shadow-md inline-block"/>
            </div>
            <div class="mt-4 flex items-center gap-4">
                <button id="generateFromImageBtn" class="btn-primary" disabled>Buat Deskripsi dari Gambar</button>
                <div id="image-loader" class="loader hidden"></div>
            </div>
        </div>

        <div class="text-center my-6 relative">
            <div class="absolute inset-0 flex items-center" aria-hidden="true"><div class="w-full border-t border-gray-300"></div></div>
            <div class="relative flex justify-center"><span class="bg-white px-2 text-sm text-gray-500">ATAU</span></div>
        </div>
        
        <h2 class="section-title">Opsi 2: Buat Prompt Secara Manual</h2>

        <h3 class="text-lg font-semibold text-gray-700 mt-6 mb-3">Pengaturan Umum Video</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
            <div>
                <label for="videoType" class="block text-gray-700 text-sm font-medium mb-2">Gaya Visual Video:</label>
                <select id="videoType">
                    <option value="video sinematik">Video Sinematik</option> <option value="animasi pendek">Animasi Pendek</option> <option value="cuplikan iklan">Cuplikan Iklan</option> <option value="video dokumenter">Video Dokumenter</option> <option value="gaya vlog">Gaya Vlog</option> <option value="video musik">Video Musik</option> <option value="cuplikan film">Cuplikan Film</option> <option value="video time-lapse">Video Time-Lapse</option> <option value="video stop-motion">Video Stop-Motion</option>
                </select>
            </div>
             <div>
                <label for="cameraStyle" class="block text-gray-700 text-sm font-medium mb-2">Gaya Artistik Umum:</label>
                 <select id="cameraStyle">
                    <option value="realistis">Realistis</option> <option value="abstrak">Abstrak</option> <option value="minimalis">Minimalis</option> <option value="fantasi">Fantasi</option> <option value="sci-fi">Sci-Fi</option> <option value="vintage">Vintage</option> <option value="noir">Noir</option>
                </select>
            </div>
        </div>

        <h3 class="text-lg font-semibold text-gray-700 mt-6 mb-3">Karakter</h3>
        <div id="characterInputsContainer"></div>
        <div class="flex justify-center my-4"><button id="addCharacterBtn" class="btn-secondary">Tambah Karakter</button></div>
        
        <h3 class="text-lg font-semibold text-gray-700 mt-6 mb-3">Latar Umum</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
            <div class="md:col-span-2"><label for="location" class="block text-gray-700 text-sm font-medium mb-2">Lokasi:</label><textarea id="location" rows="3" placeholder="Contoh: Di puncak gunung bersalju; Jalanan kota Tokyo yang ramai"></textarea></div>
            <div><label for="time" class="block text-gray-700 text-sm font-medium mb-2">Waktu:</label><select id="time"><option value="pagi hari">Pagi Hari</option><option value="siang hari">Siang Hari</option><option value="sore hari">Sore Hari</option><option value="malam hari">Malam Hari</option><option value="fajar">Fajar</option><option value="senja">Senja</option></select></div>
            <div><label for="weather" class="block text-gray-700 text-sm font-medium mb-2">Cuaca:</label><select id="weather"><option value="cerah">Cerah</option><option value="berawan">Berawan</option><option value="hujan">Hujan</option><option value="bersalju">Bersalju</option><option value="berkabut">Berkabut</option><option value="badai">Badai</option></select></div>
            <div><label for="season" class="block text-gray-700 text-sm font-medium mb-2">Musim:</label><select id="season"><option value="semi">Semi</option><option value="panas">Panas</option><option value="gugur">Gugur</option><option value="dingin">Dingin</option></select></div>
        </div>

        <h3 class="text-lg font-semibold text-gray-700 mt-8 mb-3">Rangkaian Adegan (Shoots)</h3>
        <div id="sceneInputsContainer"></div>
        <div class="flex justify-center my-4"><button id="addSceneBtn" class="btn-secondary">Tambah Adegan</button></div>

        <h3 class="text-lg font-semibold text-gray-700 mt-8 mb-3">Audio</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div>
                <label for="dialogType" class="block text-gray-700 text-sm font-medium mb-2">Dialog:</label>
                <select id="dialogType">
                    <option value="tanpa dialog">Tanpa Dialog</option>
                    <option value="informatif">Informatif</option>
                    <option value="dialog natural">Dialog Natural</option>
                    <option value="monolog">Monolog</option>
                    <option value="interview">Wawancara</option>
                </select>
            </div>
            <div id="dialogCharacterSection" class="hidden md:col-span-2">
                <label for="dialogCharacter" class="block text-gray-700 text-sm font-medium mb-2">Karakter Dialog:</label>
                <select id="dialogCharacter" class="max-w-xs"></select>
                <div id="dialogContentContainer" class="mt-2"></div>
            </div>
            <div>
                <label for="moodSound" class="block text-gray-700 text-sm font-medium mb-2">Mood Suara:</label>
                <select id="moodSound"><option value="happy">Happy</option><option value="sad">Sad</option><option value="cheerful">Cheerful</option><option value="angry">Angry</option><option value="calm">Calm</option><option value="nervous">Nervous</option><option value="enthusiastic">Enthusiastic</option></select>
            </div>
            <div>
                <label for="environmentSound" class="block text-gray-700 text-sm font-medium mb-2">Suara Lingkungan:</label>
                <input type="text" id="environmentSound" placeholder="Contoh: Suara ombak, Kebisingan kota">
            </div>
            <div class="md:col-span-2">
                <label for="backgroundMusic" class="block text-gray-700 text-sm font-medium mb-2">Musik Latar:</label>
                <input type="text" id="backgroundMusic" placeholder="Contoh: Musik orkestra epik, Melodi piano tenang">
            </div>
        </div>

        <h3 class="text-lg font-semibold text-gray-700 mt-8 mb-3">Pengaturan Akhir</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <div><label for="videoQuality" class="block text-gray-700 text-sm font-medium mb-2">Kualitas Video:</label><select id="videoQuality"><option value="HD">HD (720p)</option><option value="Full HD">Full HD (1080p)</option><option value="4K">4K (2160p)</option><option value="8K">8K (4320p)</option></select></div>
            <div><label for="videoDuration" class="block text-gray-700 text-sm font-medium mb-2">Durasi Video:</label><select id="videoDuration"><option value="6 detik">6 Detik</option><option value="7 detik">7 Detik</option><option value="8 detik">8 Detik</option></select></div>
            <div><label for="videoRatio" class="block text-gray-700 text-sm font-medium mb-2">Rasio Video:</label><select id="videoRatio"><option value="LANDSCAPE 16:9">LANDSCAPE 16:9</option><option value="PORTRAIT 9:16">PORTRAIT 9:16</option></select></div>
            <div class="md:col-span-3"><label for="additionalDetails" class="block text-gray-700 text-sm font-medium mb-2">Detail Tambahan Umum:</label><textarea id="additionalDetails" rows="2" placeholder="Detail lain yang berlaku untuk seluruh video"></textarea></div>
        </div>
        
        <div class="flex justify-center gap-4 mb-8 border-t border-gray-200 pt-8">
            <button id="generateBtn" class="btn-primary">Buat Prompt</button>
            <button id="clearBtn" class="btn-secondary">Bersihkan & Reset</button>
        </div>

        <h2 class="text-xl font-semibold text-gray-800 mb-4">Hasil Prompt:</h2>
        <div class="mb-6"><label for="promptId" class="block text-gray-700 text-sm font-medium mb-2">Prompt (Bahasa Indonesia):</label><textarea id="promptId" class="prompt-output" readonly></textarea></div>
        <div><label for="promptEn" class="block text-gray-700 text-sm font-medium mb-2">Prompt (English):</label><textarea id="promptEn" class="prompt-output" readonly></textarea></div>
    </div>
    
    <template id="characterTemplate">
        <div class="character-block" data-character-id="">
            <div class="flex justify-between items-center mb-4"><h4 class="font-semibold text-gray-700 text-lg">Karakter</h4><button type="button" class="remove-character-btn btn-danger text-xs px-2 py-1">Hapus</button></div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div><label class="block text-gray-700 text-sm font-medium mb-2">Nama Karakter:</label><input type="text" class="character-name" placeholder="Contoh: Budi, Susan" required></div>
                <div><label class="block text-gray-700 text-sm font-medium mb-2">Race/Ethnicity:</label><input type="text" class="character-race" placeholder="Contoh: Asia, Kaukasia"></div>
                <div><label class="block text-gray-700 text-sm font-medium mb-2">Perkiraan Usia:</label><input type="text" class="character-age" placeholder="Contoh: 25 tahun, Paruh baya"></div>
                <div><label class="block text-gray-700 text-sm font-medium mb-2">Bentuk Tubuh:</label><input type="text" class="character-body-shape" placeholder="Contoh: Atletis, Langsing"></div>
                <div><label class="block text-gray-700 text-sm font-medium mb-2">Perkiraan Tinggi Badan:</label><input type="text" class="character-height" placeholder="Contoh: 175 cm"></div>
                <div><label class="block text-gray-700 text-sm font-medium mb-2">Kewarganegaraan:</label><input type="text" class="character-nationality" placeholder="Contoh: Indonesia"></div>
                <div class="md:col-span-2"><label class="block text-gray-700 text-sm font-medium mb-2">Detail Konsisten (Wajah, Rambut, dll.):</label><textarea class="character-consistent-details" rows="2" placeholder="Contoh: Wajah oval, rambut hitam ikal, mata cokelat"></textarea></div>
                <div class="md:col-span-2"><label class="block text-gray-700 text-sm font-medium mb-2">Pakaian (Clothing):</label><textarea class="character-clothing" rows="2" placeholder="Contoh: Kemeja flanel merah, celana jeans biru"></textarea></div>
                <div><label class="block text-gray-700 text-sm font-medium mb-2">Gaya (Style):</label><input type="text" class="character-style" placeholder="Contoh: Kasual, Formal"></div>
                <div><label class="block text-gray-700 text-sm font-medium mb-2">Aksesoris:</label><input type="text" class="character-accessories" placeholder="Contoh: Kacamata, Jam tangan"></div>
                <div class="md:col-span-2"><label class="block text-gray-700 text-sm font-medium mb-2">Aksi Utama/Umum:</label><textarea class="character-main-action" rows="2" placeholder="Jelaskan secara naratif aksi atau situasi utama dalam gambar"></textarea></div>
                <div><label class="block text-gray-700 text-sm font-medium mb-2">Pose:</label><input type="text" class="character-pose" placeholder="Contoh: Duduk bersila, Berdiri tegap"></div>
                <div>
                    <label class="block text-gray-700 text-sm font-medium mb-2">Emosi Umum:</label>
                    <select class="character-emotion"><option value="">Pilih Emosi</option><option value="ceria">Ceria</option><option value="sedih">Sedih</option><option value="marah">Marah</option><option value="antusias">Antusias</option><option value="tenang">Tenang</option><option value="penasaran">Penasaran</option><option value="datar">Datar</option></select>
                </div>
                 <div class="md:col-span-2"><label class="block text-gray-700 text-sm font-medium mb-2">Detail Tambahan Karakter:</label><textarea class="character-additional-details" rows="2" placeholder="Contoh: Memiliki bekas luka di pipi"></textarea></div>
            </div>
        </div>
    </template>

    <template id="sceneTemplate">
        <div class="scene-block" data-scene-id="">
             <div class="flex justify-between items-center mb-4"><h4 class="font-semibold text-gray-700 text-lg">Adegan</h4><button type="button" class="remove-scene-btn btn-danger text-xs px-2 py-1">Hapus</button></div>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="md:col-span-2"><label class="block text-gray-700 text-sm font-medium mb-2">Deskripsi Aksi Adegan:</label><textarea class="scene-description" rows="3" placeholder="Jelaskan apa yang terjadi di adegan ini. Contoh: Seorang pria berlari melintasi jembatan."></textarea></div>
                <div><label class="block text-gray-700 text-sm font-medium mb-2">Pergerakan Kamera:</label><select class="scene-camera-movement"><option value="statis">Statis</option><option value="pan">Pan</option><option value="tilt">Tilt</option><option value="dolly">Dolly</option><option value="zoom">Zoom</option><option value="crane">Crane</option><option value="handheld">Handheld</option><option value="drone">Drone</option><option value="stabil">Stabil</option></select></div>
                <div><label class="block text-gray-700 text-sm font-medium mb-2">Sudut Kamera:</label><select class="scene-camera-angle"><option value="eye-level">Eye-level</option><option value="low-angle">Low Angle</option><option value="high-angle">High Angle</option><option value="dutch-angle">Dutch Angle</option><option value="bird-eye">Bird's Eye</option><option value="worm-eye">Worm's Eye</option></select></div>
                <div><label class="block text-gray-700 text-sm font-medium mb-2">Fokus:</label><select class="scene-camera-focus"><option value="dalam">Dalam</option><option value="dangkal">Dangkal</option><option value="rack-focus">Rack Focus</option></select></div>
                <div><label class="block text-gray-700 text-sm font-medium mb-2">Pencahayaan:</label><select class="scene-lighting"><option value="terang">Terang</option><option value="gelap">Gelap</option><option value="natural">Natural</option><option value="dramatis">Dramatis</option><option value="siluet">Siluet</option><option value="lembut">Lembut</option><option value="keras">Keras</option></select></div>
                <div><label class="block text-gray-700 text-sm font-medium mb-2">Gradasi Warna:</label><select class="scene-color-grading"><option value="hangat">Hangat</option><option value="dingin">Dingin</option><option value="monokrom">Monokrom</option><option value="vibran">Vibran</option><option value="pastel">Pastel</option><option value="retro">Retro</option></select></div>
            </div>
        </div>
    </template>

    <div id="myModal" class="modal"><div class="modal-content"><span class="close-button">&times;</span><div id="modalMessage" class="text-gray-800 break-words text-left"></div><button class="btn-primary mt-4" onclick="document.getElementById('myModal').style.display = 'none';">OK</button></div></div>
    <div id="welcomeModal" class="modal"><div class="modal-content"><p class="text-black-800 mb-4">Aplikasi ini dibuat oleh PAPAHNYA IBRACOBRA.</p><button id="closeWelcomeBtn" class="btn-primary">OK</button></div></div>

    <script>
        // --- UTILITY AND GLOBAL VARIABLES ---
        const getById = (id) => document.getElementById(id);
        let characterCounter = 0;
        let sceneCounter = 0;

        // --- DOM ELEMENTS ---
        const apiKeyInput = getById('apiKeyInput');
        const imageUpload = getById('imageUpload'), imagePreviewContainer = getById('image-preview-container'), imagePreview = getById('imagePreview'), generateFromImageBtn = getById('generateFromImageBtn'), imageTargetSelect = getById('imageTarget'), imageLoader = getById('image-loader');
        const videoTypeSelect = getById('videoType'), cameraStyleSelect = getById('cameraStyle');
        const addCharacterBtn = getById('addCharacterBtn'), characterInputsContainer = getById('characterInputsContainer'), characterTemplate = getById('characterTemplate');
        const locationInput = getById('location'), timeSelect = getById('time'), weatherSelect = getById('weather'), seasonSelect = getById('season');
        const addSceneBtn = getById('addSceneBtn'), sceneInputsContainer = getById('sceneInputsContainer'), sceneTemplate = getById('sceneTemplate');
        const dialogTypeSelect = getById('dialogType'), dialogCharacterSection = getById('dialogCharacterSection'), dialogCharacterSelect = getById('dialogCharacter'), dialogContentContainer = getById('dialogContentContainer'), moodSoundSelect = getById('moodSound'), environmentSoundInput = getById('environmentSound'), backgroundMusicInput = getById('backgroundMusic');
        const videoQualitySelect = getById('videoQuality'), videoDurationSelect = getById('videoDuration'), videoRatioSelect = getById('videoRatio'), additionalDetailsTextarea = getById('additionalDetails');
        const promptIdOutput = getById('promptId'), promptEnOutput = getById('promptEn'), generateBtn = getById('generateBtn'), clearBtn = getById('clearBtn');
        const modal = getById('myModal'), modalMessage = getById('modalMessage'), closeButton = document.querySelector(".close-button"), welcomeModal = getById('welcomeModal'), closeWelcomeBtn = getById('closeWelcomeBtn');

        // --- TRANSLATION DICTIONARY ---
        const translations = { "video sinematik": "Cinematic Video", "animasi pendek": "Short Animation", "cuplikan iklan": "Advertisement Snippet", "video dokumenter": "Documentary Video", "gaya vlog": "Vlog Style", "video musik": "Music Video", "cuplikan film": "Movie Clip", "video time-lapse": "Time-Lapse Video", "video stop-motion": "Stop-Motion Video", "ceria": "cheerful", "sedih": "sad", "marah": "angry", "antusias": "enthusiastic", "tenang": "calm", "penasaran": "curious", "datar": "flat", "pagi hari": "morning", "siang hari": "daytime", "sore hari": "afternoon", "malam hari": "night", "fajar": "dawn", "senja": "dusk", "cerah": "clear", "berawan": "cloudy", "hujan": "rainy", "bersalju": "snowy", "berkabut": "foggy", "badai": "stormy", "semi": "spring", "panas": "summer", "gugur": "autumn", "dingin": "winter", "realistis": "realistic", "abstrak": "abstract", "minimalis": "minimalist", "fantasi": "fantasy", "sci-fi": "sci-fi", "vintage": "vintage", "noir": "noir", "statis": "static", "pan": "panning", "tilt": "tilting", "dolly": "dollying", "zoom": "zooming", "crane": "crane shot", "handheld": "handheld", "drone": "drone shot", "stabil": "stable camera movement", "eye-level": "eye-level", "low-angle": "low angle", "high-angle": "high angle", "dutch-angle": "dutch angle", "bird-eye": "bird's eye view", "worm-eye": "worm's eye view", "dalam": "deep focus", "dangkal": "shallow focus", "rack-focus": "rack focus", "terang": "bright", "gelap": "dark", "natural": "natural", "dramatis": "dramatic", "siluet": "silhouette", "lembut": "soft", "keras": "hard", "hangat": "warm", "dingin": "cool", "monokrom": "monochrome", "vibran": "vibrant", "pastel": "pastel", "retro": "retro", "tanpa dialog": "no dialogue", "informatif": "informative", "dialog natural": "natural dialogue", "monolog": "monologue", "wawancara": "interview", "happy": "happy", "sad": "sad", "cheerful": "cheerful", "angry": "angry", "calm": "calm", "nervous": "nervous", "enthusiastic": "enthusiastic", "HD": "HD", "Full HD": "Full HD", "4K": "4K", "8K": "8K", "6 detik": "6 seconds", "7 detik": "7 seconds", "8 detik": "8 seconds", "LANDSCAPE 16:9": "LANDSCAPE 16:9", "PORTRAIT 9:16": "PORTRAIT 9:16" };
        const translatePhrase = (phrase) => translations[phrase.toLowerCase()] || phrase;

        // --- MODAL & ALERT FUNCTIONS ---
        const showAlert = (message) => {
            if (!message || typeof message !== 'string' || message.trim() === '') return;
            modalMessage.innerHTML = message;
            modal.style.display = "flex";
        };
        closeButton.onclick = () => modal.style.display = "none";
        
        // --- IMAGE-BASED GENERATION ---
        imageUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => { imagePreview.src = e.target.result; imagePreviewContainer.classList.remove('hidden'); generateFromImageBtn.disabled = false; };
                reader.readAsDataURL(file);
            } else { imagePreviewContainer.classList.add('hidden'); generateFromImageBtn.disabled = true; }
        });

        generateFromImageBtn.addEventListener('click', () => {
            const file = imageUpload.files[0];
            const targetId = imageTargetSelect.value;
            const apiKey = apiKeyInput.value.trim();

            if (!apiKey) { showAlert("<p>API Key Google AI diperlukan. Silakan masukkan di kolom yang tersedia.</p>"); return; }
            if (!file) { showAlert("<p>Silakan pilih file gambar.</p>"); return; }
            if (!targetId) { showAlert("<p>Mohon pilih target deskripsi (Karakter atau Latar).</p>"); return; }
            
            imageLoader.classList.remove('hidden');
            generateFromImageBtn.disabled = true;

            const reader = new FileReader();
            reader.onload = async (e) => {
                const base64ImageData = e.target.result.split(',')[1];
                const prompt = "Analisis gambar ini secara mendetail dan berikan respons dalam format JSON. Pastikan untuk mengisi semua kunci berikut:\n1. `aksi_utama`: Jelaskan aksi atau situasi utama dalam gambar secara lengkap, naratif, dan terperinci.\n2. `emosi`: Tentukan emosi umum subjek (misal: ceria, sedih, fokus, dll.).\n3. `aksesoris`: Sebutkan semua aksesoris yang terlihat pada subjek.\n4. `detail_tambahan_karakter`: Sebutkan detail unik atau tambahan lainnya pada karakter.\n5. `ras`, `perkiraan_usia`, `bentuk_tubuh`, `perkiraan_tinggi`.\n6. `pakaian`, `gaya`, `pose`.\n7. `deskripsi_konsisten`: Detail penting untuk konsistensi (wajah, rambut, dll).\n8. `lokasi_detail`: Deskripsi lokasi.\n9. `detail_latar`: Objek JSON berisi `waktu`, `cuaca`, `musim`.\nGunakan string kosong atau null jika suatu detail benar-benar tidak dapat ditentukan.";
                
                const payload = {
                    contents: [{
                        parts: [
                            { text: prompt },
                            { inline_data: { mime_type: file.type, data: base64ImageData } }
                        ]
                    }],
                    generationConfig: {
                        response_mime_type: "application/json",
                    }
                };
                
                try {
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });

                    if (!response.ok) {
                        let errorMsg = `Panggilan API gagal: ${response.status}`;
                        try { 
                            const errorBody = await response.json(); 
                            errorMsg += `<br>Pesan: ${errorBody.error.message}`; 
                        } catch (e) { 
                            errorMsg += `<br>Status: ${response.statusText}`; 
                        }
                        throw new Error(errorMsg);
                    }

                    const result = await response.json();
                    
                    if (result.candidates?.[0]?.content?.parts?.[0]) {
                        const responseText = result.candidates[0].content.parts[0].text;
                        let data;
                        try { data = JSON.parse(responseText); } catch (e) { throw new Error("Menerima respons JSON yang tidak valid dari AI."); }

                        if (data.detail_latar) { 
                            if (data.detail_latar.waktu) timeSelect.value = data.detail_latar.waktu; 
                            if (data.detail_latar.cuaca) weatherSelect.value = data.detail_latar.cuaca; 
                            if (data.detail_latar.musim) seasonSelect.value = data.detail_latar.musim;
                        }

                        if (targetId === 'location') {
                            if (data.lokasi_detail) locationInput.value = data.lokasi_detail;
                            showAlert('<p>Deskripsi lokasi dan latar berhasil diisi dari gambar.</p>');
                        } else {
                            const targetBlock = document.querySelector(`.character-block[data-character-id="${targetId}"]`);
                            if (targetBlock) {
                                const keyMap = {
                                    'ras': '.character-race', 'perkiraan_usia': '.character-age', 'bentuk_tubuh': '.character-body-shape',
                                    'perkiraan_tinggi': '.character-height', 'kewarganegaraan': '.character-nationality',
                                    'deskripsi_konsisten': '.character-consistent-details', 'pakaian': '.character-clothing', 'gaya': '.character-style',
                                    'aksesoris': '.character-accessories', 'aksi_utama': '.character-main-action', 'pose': '.character-pose',
                                    'emosi': '.character-emotion', 'detail_tambahan_karakter': '.character-additional-details'
                                };
                                
                                for (const key in keyMap) {
                                    if (data[key]) {
                                        const input = targetBlock.querySelector(keyMap[key]);
                                        if (input) {
                                            let valueToSet = data[key];
                                            if (typeof valueToSet === 'object' && valueToSet !== null) {
                                                valueToSet = Object.entries(valueToSet)
                                                                 .map(([objKey, objValue]) => `${objKey}: ${objValue}`)
                                                                 .join(', ');
                                            }
                                            input.value = valueToSet;
                                        }
                                    }
                                }
                                showAlert(`<p>Deskripsi detail untuk karakter yang dipilih berhasil dibuat.</p>`);
                            } else { showAlert("<p>Karakter target tidak ditemukan.</p>"); }
                        }
                    } else { throw new Error(result.promptFeedback ? `Permintaan diblokir: ${result.promptFeedback.blockReason}` : "Respons API kosong atau tidak valid."); }
                } catch (error) { console.error("Error:", error); showAlert(`<p>${error.message}</p>`); } finally { imageLoader.classList.add('hidden'); generateFromImageBtn.disabled = false; }
            };
            reader.readAsDataURL(file);
        });

        // --- DYNAMIC UI FUNCTIONS (Characters, Scenes, Dialog) ---
        const getCharacters = () => Array.from(document.querySelectorAll('.character-block')).map(block => ({ id: block.dataset.characterId, name: block.querySelector('.character-name').value.trim() || `Karakter ${block.dataset.characterId}` }));
        
        const updateAllDropdowns = () => {
            updateImageTargetDropdown();
            updateDialogCharacterDropdown();
        };

        const updateImageTargetDropdown = () => {
            const characters = getCharacters();
            const selectedValue = imageTargetSelect.value;
            imageTargetSelect.innerHTML = '<option value="location">Latar/Lokasi Umum</option>';
            if (characters.length > 0) { imageTargetSelect.innerHTML += characters.map(char => `<option value="${char.id}">${char.name}</option>`).join(''); }
            if (selectedValue && Array.from(imageTargetSelect.options).some(opt => opt.value === selectedValue)) { imageTargetSelect.value = selectedValue; }
        };

        const updateDialogCharacterDropdown = () => {
            const characters = getCharacters();
            const selectedValue = dialogCharacterSelect.value;
            dialogCharacterSelect.innerHTML = '';
            if (dialogTypeSelect.value !== "tanpa dialog" && characters.length > 0) {
                dialogCharacterSelect.innerHTML = `<option value="all">Semua Karakter</option>` + characters.map(char => `<option value="${char.id}">${char.name}</option>`).join('');
                dialogCharacterSelect.value = selectedValue || 'all';
            }
            updateDialogContentInputs();
        };

        const updateDialogContentInputs = () => {
            const characters = getCharacters();
            dialogContentContainer.innerHTML = '';
            const dialogType = dialogTypeSelect.value;
            const selectedCharId = dialogCharacterSelect.value;
            if (dialogType === "tanpa dialog") { dialogCharacterSection.classList.add('hidden'); return; }
            dialogCharacterSection.classList.remove('hidden');
            const createDialogTextarea = (char) => `<div class="dialog-content-block"><label for="dialogContent-${char.id}" class="block text-gray-700 text-sm font-medium mb-1">Dialog ${char.name}:</label><textarea id="dialogContent-${char.id}" class="w-full dialog-content-textarea" rows="2" placeholder="Tulis dialog..."></textarea></div>`;
            if (selectedCharId === 'all' && characters.length > 0) {
                dialogContentContainer.innerHTML = characters.map(createDialogTextarea).join('');
            } else if (selectedCharId) {
                const selectedChar = characters.find(char => char.id == selectedCharId);
                if (selectedChar) dialogContentContainer.innerHTML = createDialogTextarea(selectedChar);
            }
        };

        const addCharacter = () => {
            characterCounter++;
            const clone = characterTemplate.content.cloneNode(true);
            const block = clone.querySelector('.character-block');
            block.dataset.characterId = characterCounter;
            block.querySelector('h4').textContent = `Karakter ${characterCounter}`;
            block.querySelector('.character-name').addEventListener('input', updateAllDropdowns);
            block.querySelector('.remove-character-btn').onclick = () => { block.remove(); updateAllDropdowns(); };
            characterInputsContainer.appendChild(clone);
            updateAllDropdowns();
        };

        const addScene = () => {
            sceneCounter++;
            const clone = sceneTemplate.content.cloneNode(true);
            const block = clone.querySelector('.scene-block');
            block.dataset.sceneId = sceneCounter;
            block.querySelector('h4').textContent = `Adegan ${sceneCounter}`;
            block.querySelector('.remove-scene-btn').onclick = () => block.remove();
            sceneInputsContainer.appendChild(clone);
        };

        // --- PROMPT GENERATION ---
        const generatePrompt = () => {
            const characters = Array.from(document.querySelectorAll('.character-block')).map(c => {
                const details = {};
                c.querySelectorAll('input, textarea, select').forEach(i => {
                    if (i.value.trim()) {
                        const key = i.className.split(' ')[0].replace('character-', '').replace(/-/g, ' ');
                        details[key] = i.value.trim();
                    }
                });
                return details;
            });
            if (characters.length > 0 && characters.some(c => !c.name || !c['consistent details'])) { showAlert("<p>Mohon lengkapi <b>Nama</b> dan <b>Detail Konsisten</b> untuk setiap karakter.</p>"); return; }
            if (!locationInput.value.trim()) { showAlert("<p>Mohon lengkapi <b>Lokasi</b>.</p>"); return; }
            
            const scenes = Array.from(document.querySelectorAll('.scene-block')).map((s, index) => {
                const details = { sceneNumber: index + 1 };
                 s.querySelectorAll('textarea, select').forEach(i => {
                    const key = i.className.split(' ')[0].replace('scene-', '').replace(/-/g, '_');
                    details[key] = i.value.trim();
                });
                return details;
            });
            if (scenes.length === 0 || scenes.some(s => !s.description)) { showAlert("<p>Mohon tambahkan setidaknya satu adegan dan isi <b>Deskripsi Aksi Adegan</b>.</p>"); return; }

            const characterDescriptionsId = characters.map(c => `[${Object.entries(c).map(([key, value]) => `${key}: ${value}`).join(', ')}]`).join('; ');
            const characterDescriptionsEn = characters.map(c => `[${Object.entries(c).map(([key, value]) => `${key}: ${translatePhrase(value) || value}`).join(', ')}]`).join('; ');
            const finalSubjectId = characters.length > 0 ? `Karakter yang terlibat: ${characterDescriptionsId}` : 'Tidak ada karakter spesifik.';
            const finalSubjectEn = characters.length > 0 ? `Characters involved: ${characterDescriptionsEn}` : 'No specific characters.';

            const sceneDescriptionsId = scenes.map(s => `Adegan ${s.sceneNumber}: ${s.description}. Kamera: pergerakan ${s.camera_movement}, sudut ${s.camera_angle}, fokus ${s.camera_focus}, pencahayaan ${s.lighting}, warna ${s.color_grading}.`).join(' ');
            const sceneDescriptionsEn = scenes.map(s => `Scene ${s.sceneNumber}: ${s.description}. Camera: ${translatePhrase(s.camera_movement)} movement, ${translatePhrase(s.camera_angle)} angle, ${translatePhrase(s.camera_focus)} focus, ${translatePhrase(s.lighting)} lighting, ${translatePhrase(s.color_grading)} color.`).join(' ');

            let dialogContentId = '', dialogContentEn = '';
            if (dialogTypeSelect.value !== "tanpa dialog") {
                const allDialogsId = [], allDialogsEn = [];
                document.querySelectorAll('.dialog-content-textarea').forEach(textarea => {
                    if (textarea.value.trim()) {
                        const charId = textarea.id.replace('dialogContent-', '');
                        const charName = getCharacters().find(c => c.id == charId)?.name || `Karakter ${charId}`;
                        allDialogsId.push(`${charName} berkata: "${textarea.value.trim()}"`);
                        allDialogsEn.push(`${charName} says: "${textarea.value.trim()}"`);
                    }
                });
                if (allDialogsId.length > 0) {
                    dialogContentId = ` Isi dialog: ${allDialogsId.join('; ')}.`;
                    dialogContentEn = ` Dialogue content: ${allDialogsEn.join('; ')}.`;
                }
            }

            const audioId = `Dialog: ${dialogTypeSelect.value}.${dialogContentId} Mood suara: ${moodSoundSelect.value}. Suara lingkungan: ${environmentSoundInput.value.trim() || 'Tidak ada'}. Musik latar: ${backgroundMusicInput.value.trim() || 'Tidak ada'}.`;
            const audioEn = `Dialogue: ${translatePhrase(dialogTypeSelect.value)}.${dialogContentEn} Sound mood: ${translatePhrase(moodSoundSelect.value)}. Environment sound: ${environmentSoundInput.value.trim() || 'None'}. Background music: ${backgroundMusicInput.value.trim() || 'None'}.`;
            
            const backgroundId = `Berlatar di ${locationInput.value} pada ${timeSelect.value}, cuaca ${weatherSelect.value}, musim ${seasonSelect.value}.`;
            const backgroundEn = `Set in ${locationInput.value} during the ${translatePhrase(timeSelect.value)}, ${translatePhrase(weatherSelect.value)} weather, in ${translatePhrase(seasonSelect.value)}.`;
            const videoSpecsId = `Kualitas ${videoQualitySelect.value}, durasi ${videoDurationSelect.value}, rasio ${videoRatioSelect.value}.`;
            const videoSpecsEn = `${translatePhrase(videoQualitySelect.value)} quality, ${translatePhrase(videoDurationSelect.value)} duration, ${translatePhrase(videoRatioSelect.value)} aspect ratio.`;
            const videoType = videoTypeSelect.value;
            const cameraStyle = cameraStyleSelect.value;
            const additional = additionalDetailsTextarea.value.trim();
            
            promptIdOutput.value = [`Sebuah ${videoType} dengan gaya artistik ${cameraStyle}.`, finalSubjectId, backgroundId, `Rangkaian adegan: ${sceneDescriptionsId}`, `Audio: ${audioId}`, videoSpecsId, additional ? `Detail tambahan: ${additional}` : ''].filter(Boolean).join('\n\n');
            promptEnOutput.value = [`A ${translatePhrase(videoType)} with a ${translatePhrase(cameraStyle)} artistic style.`, finalSubjectEn, backgroundEn, `Sequence of scenes: ${sceneDescriptionsEn}`, `Audio: ${audioEn}`, videoSpecsEn, additional ? `Additional details: ${additional}` : ''].filter(Boolean).join('\n\n');
        };
        
        // --- FORM RESET ---
        const clearFields = () => {
            document.querySelectorAll('input[type="text"], input[type="password"], textarea').forEach(el => { if(el.id !== 'apiKeyInput') el.value = ''; });
            document.querySelectorAll('select').forEach(el => el.selectedIndex = 0);
            characterInputsContainer.innerHTML = ''; sceneInputsContainer.innerHTML = '';
            characterCounter = 0; sceneCounter = 0;
            imageUpload.value = ''; imagePreviewContainer.classList.add('hidden'); imagePreview.src = '#'; generateFromImageBtn.disabled = true;
            addCharacter(); addScene();
        };

        // --- EVENT LISTENERS & INITIALIZATION ---
        addCharacterBtn.addEventListener('click', addCharacter);
        addSceneBtn.addEventListener('click', addScene);
        generateBtn.addEventListener('click', generatePrompt);
        clearBtn.addEventListener('click', clearFields);
        dialogTypeSelect.addEventListener('change', updateDialogCharacterDropdown);
        dialogCharacterSelect.addEventListener('change', updateDialogContentInputs);
        closeWelcomeBtn.addEventListener('click', () => { welcomeModal.style.display = 'none'; });
        window.onclick = (event) => { if (event.target == welcomeModal || event.target == modal) event.target.style.display = "none"; };

        document.addEventListener('DOMContentLoaded', () => {
            welcomeModal.style.display = 'flex';
            addCharacter();
            addScene();
        });

    </script>
</body>
</html>