<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veo 3 Prompt Generator (Google AI)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 1.5rem;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        input, select, textarea {
            border-radius: 8px;
            border: 1px solid #d1d5db;
            padding: 0.75rem 1rem;
            width: 100%;
            transition: all 0.2s ease-in-out;
            outline: none;
            color: #374151; /* Darker text for inputs */
        }
        input:focus, select:focus, textarea:focus {
            border-color: #6366f1; /* Indigo 500 */
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.25); /* Indigo 500 with opacity */
        }
        button {
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background-color: #6366f1; /* Indigo 500 */
            color: #ffffff;
        }
        .btn-primary:hover:not(:disabled) {
            background-color: #4f46e5; /* Indigo 600 */
        }
         .btn-primary:disabled {
            background-color: #a5b4fc; /* Indigo 300 */
            cursor: not-allowed;
        }
        .btn-secondary {
            background-color: #e5e7eb; /* Gray 200 */
            color: #374151; /* Gray 700 */
        }
        .btn-secondary:hover {
            background-color: #d1d5db; /* Gray 300 */
        }
        .btn-danger {
            background-color: #ef4444; /* Red 500 */
            color: #ffffff;
        }
        .btn-danger:hover {
            background-color: #dc2626; /* Red 600 */
        }
        textarea.prompt-output {
            min-height: 150px; /* Increased height */
            background-color: #f9fafb;
            color: #1f2937;
            font-size: 0.95rem;
            resize: vertical;
            line-height: 1.6; /* Better readability */
        }
        .section-title {
            @apply text-xl font-semibold text-gray-800 mt-8 mb-4 border-b pb-2 border-gray-200;
        }
        .character-block {
            @apply bg-gray-50 p-4 rounded-lg mb-4 border border-gray-200;
        }
        .dialog-content-block {
            @apply bg-blue-50 p-3 rounded-lg mt-2 mb-2 border border-blue-200;
        }
        /* Custom modal styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 80%;
            max-width: 400px;
            text-align: center;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
         /* Loader styles */
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #6366f1;
            width: 30px;
            height: 30px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }

        /* Safari */
        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4">
    <div class="container">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">Veo 3 Prompt Generator v.2</h1>
        <p class="text-center text-red-500 text-sm mb-6">
            APLIKASI INI DIBUAT OLEH <span class="font-bold">Papahnya Ibracobra</span>
        </p>
        <p class="text-center text-gray-600 mb-8">
            Isi detail di bawah untuk menghasilkan prompt video yang optimal untuk Gemini (Veo 3).
        </p>
        
        <!-- API Key Input -->
        <div class="mb-6 bg-indigo-50 border border-indigo-200 p-4 rounded-lg">
            <label for="apiKeyInput" class="block text-gray-800 text-sm font-medium mb-2">Google AI API Key Anda:</label>
            <input type="password" id="apiKeyInput" placeholder="Masukkan Google AI API Key Anda" class="w-full">
            <p class="text-xs text-gray-500 mt-1">Dapatkan kunci gratis Anda dari <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-indigo-600 hover:underline">Google AI Studio</a>. Kunci tidak akan disimpan.</p>
        </div>

        <!-- Image Upload Section -->
        <h2 class="section-title">Opsi 1: Hasilkan Prompt dari Gambar (via Google AI)</h2>
        <div class="bg-gray-50 p-4 rounded-lg mb-8 border border-gray-200">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="imageUpload" class="block text-gray-700 text-sm font-medium mb-2">Unggah Gambar:</label>
                    <input type="file" id="imageUpload" accept="image/*" class="block w-full text-sm text-gray-900 bg-white rounded-lg border border-gray-300 cursor-pointer focus:outline-none p-2 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                </div>
                <div>
                    <label for="imageTarget" class="block text-gray-700 text-sm font-medium mb-2">Pilih Target Deskripsi:</label>
                    <select id="imageTarget"></select>
                </div>
            </div>
             <div id="image-preview-container" class="mt-4 hidden text-center">
                <p class="text-sm font-medium text-gray-700 mb-2">Pratinjau Gambar:</p>
                <img id="imagePreview" src="#" alt="Pratinjau Gambar" class="max-h-48 rounded-lg shadow-md inline-block"/>
            </div>
            <div class="mt-4 flex items-center gap-4">
                <button id="generateFromImageBtn" class="btn-primary" disabled>
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.085a2 2 0 00-1.736.97l-1.9 3.8a2 2 0 00.38 2.54l.5 1.5M14 10l-2 3m0 0l-2-3m2 3v7" />
                    </svg>
                    Buat Deskripsi dari Gambar
                </button>
                <div id="image-loader" class="loader hidden"></div>
            </div>
        </div>

        <div class="text-center my-6">
            <span class="text-gray-500 font-semibold bg-white px-4 z-10 relative">ATAU</span>
            <div class="border-t border-gray-200 absolute left-0 right-0" style="top: 50%;"></div>
        </div>
        
        <h2 class="section-title">Opsi 2: Buat Prompt Secara Manual</h2>

        <!-- General Video Settings -->
        <h3 class="text-lg font-semibold text-gray-700 mt-6 mb-3">Pengaturan Video Umum</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- Tipe Video/Gaya Visual -->
            <div>
                <label for="videoType" class="block text-gray-700 text-sm font-medium mb-2">Tipe Video/Gaya Visual:</label>
                <select id="videoType" class="block appearance-none bg-white border border-gray-300 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-indigo-500">
                    <option value="video sinematik">Video Sinematik (Cinematic Video)</option>
                    <option value="animasi pendek">Animasi Pendek (Short Animation)</option>
                    <option value="cuplikan iklan">Cuplikan Iklan (Advertisement Snippet)</option>
                    <option value="video dokumenter">Video Dokumenter (Documentary Video)</option>
                    <option value="gaya vlog">Gaya Vlog (Vlog Style)</option>
                    <option value="video musik">Video Musik (Music Video)</option>
                    <option value="cuplikan film">Cuplikan Film (Movie Clip)</option>
                    <option value="video time-lapse">Video Time-Lapse (Time-Lapse Video)</option>
                    <option value="video stop-motion">Video Stop-Motion (Stop-Motion Video)</option>
                </select>
            </div>
        </div>

        <!-- Detail Subjek (Character Details) -->
        <h3 class="text-lg font-semibold text-gray-700 mt-6 mb-3">Detail Subjek</h3>
        <div id="characterInputsContainer">
            <!-- Character input blocks will be dynamically added here -->
        </div>
        <div class="flex justify-center mb-8">
            <button id="addCharacterBtn" class="btn-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" />
                </svg>
                Tambah Karakter (Add Character)
            </button>
        </div>
        
        <!-- Character Template (Hidden) -->
        <template id="characterTemplate">
            <div class="character-block" data-character-id="">
                <div class="flex justify-between items-center mb-2">
                    <h4 class="font-semibold text-gray-600">Karakter</h4>
                    <button type="button" class="remove-character-btn btn-danger text-xs px-2 py-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 11-2 0v6a1 1 0 112 0V8z" clip-rule="evenodd" />
                        </svg>
                        Hapus (Remove)
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">Nama Karakter:</label>
                        <input type="text" class="character-name" placeholder="Contoh: Budi, Susan" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">Kewarganegaraan:</label>
                        <input type="text" class="character-nationality" placeholder="Contoh: Indonesia, Jepang">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Karakteristik Subjek:</label>
                        <textarea class="character-characteristics" rows="3" placeholder="Contoh: Pria paruh baya, rambut hitam, kacamata; Wanita muda, periang, rambut pirang"></textarea>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Aksi Utama:</label>
                        <input type="text" class="character-main-action" placeholder="Contoh: Sedang membaca buku di taman; Berlatih bela diri">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">Emosi:</label>
                        <select class="character-emotion">
                            <option value="ceria">Ceria (Cheerful)</option>
                            <option value="sedih">Sedih (Sad)</option>
                            <option value="marah">Marah (Angry)</option>
                            <option value="antusias">Antusias (Enthusiastic)</option>
                            <option value="tenang">Tenang (Calm)</option>
                            <option value="penasaran">Penasaran (Curious)</option>
                            <option value="datar">Datar (Flat)</option>
                        </select>
                    </div>
                </div>
            </div>
        </template>

        <!-- Latar (Background) -->
        <h3 class="text-lg font-semibold text-gray-700 mt-6 mb-3">Latar</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="md:col-span-2">
                <label for="location" class="block text-gray-700 text-sm font-medium mb-2">Lokasi:</label>
                <textarea id="location" rows="3" placeholder="Contoh: Di puncak gunung bersalju; Jalanan kota Tokyo yang ramai"></textarea>
            </div>
            <div>
                <label for="time" class="block text-gray-700 text-sm font-medium mb-2">Waktu:</label>
                <select id="time">
                    <option value="pagi hari">Pagi Hari (Morning)</option>
                    <option value="siang hari">Siang Hari (Daytime)</option>
                    <option value="sore hari">Sore Hari (Afternoon)</option>
                    <option value="malam hari">Malam Hari (Night)</option>
                    <option value="fajar">Fajar (Dawn)</option>
                    <option value="senja">Senja (Dusk)</option>
                </select>
            </div>
            <div>
                <label for="weather" class="block text-gray-700 text-sm font-medium mb-2">Cuaca:</label>
                <select id="weather">
                    <option value="cerah">Cerah (Clear)</option>
                    <option value="berawan">Berawan (Cloudy)</option>
                    <option value="hujan">Hujan (Rainy)</option>
                    <option value="bersalju">Bersalju (Snowy)</option>
                    <option value="berkabut">Berkabut (Foggy)</option>
                    <option value="badai">Badai (Stormy)</option>
                </select>
            </div>
            <div>
                <label for="season" class="block text-gray-700 text-sm font-medium mb-2">Musim:</label>
                <select id="season">
                    <option value="semi">Semi (Spring)</option>
                    <option value="panas">Panas (Summer)</option>
                    <option value="gugur">Gugur (Autumn/Fall)</option>
                    <option value="dingin">Dingin (Winter)</option>
                </select>
            </div>
        </div>

        <!-- Kamera (Camera) -->
        <h3 class="text-lg font-semibold text-gray-700 mt-6 mb-3">Kamera</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div>
                <label for="cameraStyle" class="block text-gray-700 text-sm font-medium mb-2">Gaya Kamera:</label>
                <select id="cameraStyle">
                    <option value="realistis">Realistis (Realistic)</option>
                    <option value="abstrak">Abstrak (Abstract)</option>
                    <option value="minimalis">Minimalis (Minimalist)</option>
                    <option value="fantasi">Fantasi (Fantasy)</option>
                    <option value="sci-fi">Sci-Fi (Sci-Fi)</option>
                    <option value="vintage">Vintage (Vintage)</option>
                    <option value="noir">Noir (Noir)</option>
                </select>
            </div>
            <div>
                <label for="cameraMovement" class="block text-gray-700 text-sm font-medium mb-2">Pergerakan Kamera:</label>
                <select id="cameraMovement">
                    <option value="statis">Statis (Static)</option>
                    <option value="pan">Pan (Panning)</option>
                    <option value="tilt">Tilt (Tilting)</option>
                    <option value="dolly">Dolly (Dollying)</option>
                    <option value="zoom">Zoom (Zooming)</option>
                    <option value="crane">Crane (Crane Shot)</option>
                    <option value="handheld">Handheld (Handheld)</option>
                    <option value="drone">Drone (Drone Shot)</option>
                    <option value="stabil">Stabil (Stable)</option>
                </select>
            </div>
            <div>
                <label for="cameraAngle" class="block text-gray-700 text-sm font-medium mb-2">Sudut Kamera:</label>
                <select id="cameraAngle">
                    <option value="eye-level">Eye-level (Eye-level)</option>
                    <option value="low-angle">Low Angle (Low Angle)</option>
                    <option value="high-angle">High Angle (High Angle)</option>
                    <option value="dutch-angle">Dutch Angle (Dutch Angle)</option>
                    <option value="bird-eye">Bird's Eye (Bird's Eye View)</option>
                    <option value="worm-eye">Worm's Eye (Worm's Eye View)</option>
                </select>
            </div>
            <div>
                <label for="cameraFocus" class="block text-gray-700 text-sm font-medium mb-2">Fokus:</label>
                <select id="cameraFocus">
                    <option value="dalam">Dalam (Deep Focus)</option>
                    <option value="dangkal">Dangkal (Shallow Focus)</option>
                    <option value="rack-focus">Rack Focus (Rack Focus)</option>
                </select>
            </div>
            <div>
                <label for="lighting" class="block text-gray-700 text-sm font-medium mb-2">Pencahayaan:</label>
                <select id="lighting">
                    <option value="terang">Terang (Bright)</option>
                    <option value="gelap">Gelap (Dark)</option>
                    <option value="natural">Natural (Natural)</option>
                    <option value="dramatis">Dramatis (Dramatic)</option>
                    <option value="siluet">Siluet (Silhouette)</option>
                    <option value="lembut">Lembut (Soft)</option>
                    <option value="keras">Keras (Hard)</option>
                </select>
            </div>
            <div>
                <label for="colorGrading" class="block text-gray-700 text-sm font-medium mb-2">Gradasi Warna:</label>
                <select id="colorGrading">
                    <option value="hangat">Hangat (Warm)</option>
                    <option value="dingin">Dingin (Cool)</option>
                    <option value="monokrom">Monokrom (Monochrome)</option>
                    <option value="vibran">Vibran (Vibrant)</option>
                    <option value="pastel">Pastel (Pastel)</option>
                    <option value="retro">Retro (Retro)</option>
                </select>
            </div>
        </div>

        <!-- Audio -->
        <h3 class="text-lg font-semibold text-gray-700 mt-6 mb-3">Audio</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div>
                <label for="dialogType" class="block text-gray-700 text-sm font-medium mb-2">Dialog:</label>
                <select id="dialogType">
                    <option value="tanpa dialog">Tanpa Dialog (No Dialogue)</option>
                    <option value="informatif">Informatif (Informative)</option>
                    <option value="dialog natural">Dialog Natural (Natural Dialogue)</option>
                    <option value="monolog">Monologue (Monologue)</option>
                    <option value="interview">Interview (Interview)</option>
                </select>
            </div>
            <div id="dialogCharacterSection" class="hidden md:col-span-2">
                <label for="dialogCharacter" class="block text-gray-700 text-sm font-medium mb-2">Karakter Dialog:</label>
                <select id="dialogCharacter" class="max-w-xs">
                    <!-- Options populated by JS -->
                </select>
                <div id="dialogContentContainer" class="mt-2">
                    <!-- Dialogue content textareas will be dynamically added here -->
                </div>
            </div>
            <div>
                <label for="moodSound" class="block text-gray-700 text-sm font-medium mb-2">Mood Suara:</label>
                <select id="moodSound">
                    <option value="happy">Happy (Senang)</option>
                    <option value="sad">Sad (Sedih)</option>
                    <option value="cheerful">Cheerful (Ceria)</option>
                    <option value="angry">Angry (Marah)</option>
                    <option value="calm">Calm (Tenang)</option>
                    <option value="nervous">Nervous (Gugup)</option>
                    <option value="enthusiastic">Enthusiastic (Antusias)</option>
                </select>
            </div>
            <div>
                <label for="environmentSound" class="block text-gray-700 text-sm font-medium mb-2">Suara Lingkungan:</label>
                <input type="text" id="environmentSound" placeholder="Contoh: Suara ombak, Kebisingan kota, Kicauan burung">
            </div>
            <div class="md:col-span-2">
                <label for="backgroundMusic" class="block text-gray-700 text-sm font-medium mb-2">Musik Latar:</label>
                <input type="text" id="backgroundMusic" placeholder="Contoh: Musik orkestra epik, Melodi piano yang tenang, Beat elektronik upbeat">
            </div>
        </div>

        <!-- Kualitas & Durasi Video (Video Quality & Duration) -->
        <h3 class="text-lg font-semibold text-gray-700 mt-6 mb-3">Kualitas & Durasi Video</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <div>
                <label for="videoQuality" class="block text-gray-700 text-sm font-medium mb-2">Kualitas Video:</label>
                <select id="videoQuality">
                    <option value="HD">HD (720p)</option>
                    <option value="Full HD">Full HD (1080p)</option>
                    <option value="4K">4K (2160p)</option>
                    <option value="8K">8K (4320p)</option>
                </select>
            </div>
            <div>
                <label for="videoDuration" class="block text-gray-700 text-sm font-medium mb-2">Durasi Video:</label>
                <select id="videoDuration">
                    <option value="6 detik">6 Detik (6 Seconds)</option>
                    <option value="7 detik">7 Detik (7 Seconds)</option>
                    <option value="8 detik">8 Detik (8 Seconds)</option>
                </select>
            </div>
            <div>
                <label for="videoRatio" class="block text-gray-700 text-sm font-medium mb-2">Rasio Video:</label>
                <select id="videoRatio">
                    <option value="LANDSCAPE 16:9">LANDSCAPE 16:9</option>
                    <option value="PORTRAIT 9:16">PORTRAIT 9:16</option>
                </select>
            </div>
        </div>

        <!-- Detail Tambahan (Additional Details) -->
        <h3 class="text-lg font-semibold text-gray-700 mt-6 mb-3">Detail Tambahan</h3>
        <div class="mb-8">
            <label for="additionalDetails" class="block text-gray-700 text-sm font-medium mb-2">Detail Lainnya (Opsional):</label>
            <textarea id="additionalDetails" rows="4" placeholder="Contoh: Fokus pada detail ekspresi wajah, Gunakan pencahayaan dramatis dari samping, Tambahkan efek percikan air" class="w-full"></textarea>
        </div>

        <div class="flex justify-center gap-4 mb-8 border-t border-gray-200 pt-8">
            <button id="generateBtn" class="btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" />
                </svg>
                Buat Prompt
            </button>
            <button id="clearBtn" class="btn-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                     <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7V9a1 1 0 01-2 0V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 17V15a1 1 0 112 0v5a1 1 0 01-1 1h-5a1 1 0 110-2h2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                </svg>
                Bersihkan & Reset
            </button>
        </div>

        <h2 class="text-xl font-semibold text-gray-800 mb-4">Hasil Prompt:</h2>
        <div class="mb-6">
            <label for="promptId" class="block text-gray-700 text-sm font-medium mb-2">Prompt (Bahasa Indonesia):</label>
            <textarea id="promptId" class="prompt-output" readonly></textarea>
        </div>
        <div>
            <label for="promptEn" class="block text-gray-700 text-sm font-medium mb-2">Prompt (English):</label>
            <textarea id="promptEn" class="prompt-output" readonly></textarea>
        </div>
    </div>

    <!-- Custom Modal for Alerts -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <div id="modalMessage" class="text-gray-800 text-left break-words"></div>
            <button class="btn-primary mt-4" onclick="document.getElementById('myModal').style.display = 'none';">OK</button>
        </div>
    </div>
    
    <!-- Welcome Modal -->
    <div id="welcomeModal" class="modal">
        <div class="modal-content">
            <p class="text-black-800 mb-4">Aplikasi ini dibuat oleh PAPAHNYA IBRACOBRA.</p>
            <button id="closeWelcomeBtn" class="btn-primary">OK</button>
        </div>
    </div>

    <script>
    // --- UTILITY AND GLOBAL VARIABLES ---
    const getById = (id) => document.getElementById(id);
    let characterCounter = 0;
    let sceneCounter = 0; 

    // --- DOM ELEMENTS ---
    const apiKeyInput = getById('apiKeyInput');
    const imageUpload = getById('imageUpload'), imagePreviewContainer = getById('image-preview-container'), imagePreview = getById('imagePreview'), generateFromImageBtn = getById('generateFromImageBtn'), imageTargetSelect = getById('imageTarget'), imageLoader = getById('image-loader');
    const videoTypeSelect = getById('videoType');
    const addCharacterBtn = getById('addCharacterBtn'), characterInputsContainer = getById('characterInputsContainer'), characterTemplate = getById('characterTemplate');
    const locationInput = getById('location'), timeSelect = getById('time'), weatherSelect = getById('weather'), seasonSelect = getById('season');
    
    const cameraStyleSelect = getById('cameraStyle');
    const cameraMovementSelect = getById('cameraMovement');
    const cameraAngleSelect = getById('cameraAngle');
    const cameraFocusSelect = getById('cameraFocus');
    const lightingSelect = getById('lighting');
    const colorGradingSelect = getById('colorGrading');
    const dialogTypeSelect = getById('dialogType');
    const dialogCharacterSection = getById('dialogCharacterSection');
    const dialogCharacterSelect = getById('dialogCharacter');
    const dialogContentContainer = getById('dialogContentContainer');
    const moodSoundSelect = getById('moodSound');
    const environmentSoundInput = getById('environmentSound');
    const backgroundMusicInput = getById('backgroundMusic');
    const videoQualitySelect = getById('videoQuality');
    const videoDurationSelect = getById('videoDuration');
    const videoRatioSelect = getById('videoRatio');
    const additionalDetailsTextarea = getById('additionalDetails');

    const promptIdOutput = getById('promptId'), promptEnOutput = getById('promptEn');
    const generateBtn = getById('generateBtn'), clearBtn = getById('clearBtn');
    
    const modal = getById('myModal'), modalMessage = getById('modalMessage'), closeButton = document.querySelector(".close-button"), welcomeModal = getById('welcomeModal'), closeWelcomeBtn = getById('closeWelcomeBtn');

    // --- TRANSLATION DICTIONARY ---
    const translations = { "video sinematik": "Cinematic Video", "animasi pendek": "Short Animation", "cuplikan iklan": "Advertisement Snippet", "video dokumenter": "Documentary Video", "gaya vlog": "Vlog Style", "video musik": "Music Video", "cuplikan film": "Movie Clip", "video time-lapse": "Time-Lapse Video", "video stop-motion": "Stop-Motion Video", "ceria": "cheerful", "sedih": "sad", "marah": "angry", "antusias": "enthusiastic", "tenang": "calm", "penasaran": "curious", "datar": "flat", "pagi hari": "morning", "siang hari": "daytime", "sore hari": "afternoon", "malam hari": "night", "fajar": "dawn", "senja": "dusk", "cerah": "clear", "berawan": "cloudy", "hujan": "rainy", "bersalju": "snowy", "berkabut": "foggy", "badai": "stormy", "semi": "spring", "panas": "summer", "gugur": "autumn", "dingin": "winter", "realistis": "realistic", "abstrak": "abstract", "minimalis": "minimalist", "fantasi": "fantasy", "sci-fi": "sci-fi", "vintage": "vintage", "noir": "noir", "statis": "static", "pan": "panning", "tilt": "tilting", "dolly": "dollying", "zoom": "zooming", "crane": "crane shot", "handheld": "handheld", "drone": "drone shot", "stabil": "stable", "eye-level": "eye-level", "low-angle": "low angle", "high-angle": "high angle", "dutch-angle": "dutch angle", "bird-eye": "bird's eye view", "worm-eye": "worm's eye view", "dalam": "deep focus", "dangkal": "shallow focus", "rack-focus": "rack focus", "terang": "bright", "gelap": "dark", "natural": "natural", "dramatis": "dramatic", "siluet": "silhouette", "lembut": "soft", "keras": "hard", "hangat": "warm", "dingin": "cool", "monokrom": "monochrome", "vibran": "vibrant", "pastel": "pastel", "retro": "retro", "tanpa dialog": "no dialogue", "informatif": "informative dialogue", "dialog natural": "natural dialogue", "monolog": "monologue", "interview": "interview", "happy": "happy", "sad": "sad", "cheerful": "cheerful", "angry": "angry", "calm": "calm", "nervous": "nervous", "enthusiastic": "enthusiastic", "HD": "HD", "Full HD": "Full HD", "4K": "4K", "8K": "8K", "6 detik": "6 seconds", "7 detik": "7 seconds", "8 detik": "8 seconds", "LANDSCAPE 16:9": "LANDSCAPE 16:9", "PORTRAIT 9:16": "PORTRAIT 9:16" };
    const translatePhrase = (phrase) => translations[phrase.toLowerCase()] || phrase;

    // --- MODAL & ALERT FUNCTIONS ---
    const showAlert = (htmlMessage) => {
        if (!htmlMessage || typeof htmlMessage !== 'string' || htmlMessage.trim() === '') {
             console.warn("showAlert called with an empty or invalid message. Suppressing.");
             return;
        }
        modalMessage.innerHTML = htmlMessage;
        modal.style.display = "flex";
    };
    closeButton.onclick = () => modal.style.display = "none";
    
    // --- IMAGE-BASED GENERATION (THE CORRECTED VERSION) ---
    imageUpload.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => { imagePreview.src = e.target.result; imagePreviewContainer.classList.remove('hidden'); generateFromImageBtn.disabled = false; };
            reader.readAsDataURL(file);
        } else { imagePreviewContainer.classList.add('hidden'); generateFromImageBtn.disabled = true; }
    });

    generateFromImageBtn.addEventListener('click', () => {
        const file = imageUpload.files[0];
        const targetId = imageTargetSelect.value;
        const apiKey = apiKeyInput.value.trim();

        if (!apiKey) { showAlert("<p>API Key Google AI diperlukan. Silakan masukkan di kolom yang tersedia.</p>"); return; }
        if (!file) { showAlert("<p>Silakan pilih file gambar.</p>"); return; }
        if (!targetId) { showAlert("<p>Mohon pilih target deskripsi (Karakter atau Latar).</p>"); return; }
        
        imageLoader.classList.remove('hidden');
        generateFromImageBtn.disabled = true;

        const reader = new FileReader();
        reader.onload = async (e) => {
            const base64ImageData = e.target.result.split(',')[1];
            const prompt = "Analisis gambar ini dan berikan respons dalam format JSON. Sediakan: 1. `deskripsi_detail`: Deskripsi naratif yang sangat detail dan kaya tentang subjek atau pemandangan. 2. `aksi_utama`: Jika ada, frasa singkat yang merangkum aksi utama. Jika tidak, kembalikan null. 3. `emosi`: Jika ada subjek, satu kata emosinya (ceria, sedih, marah, antusias, tenang, penasaran, datar). Jika tidak ada, kembalikan null. 4. `detail_latar`: Objek berisi `waktu` (pagi hari, siang hari, sore hari, malam hari, fajar, senja), `cuaca` (cerah, berawan, hujan, bersalju, berkabut, badai), dan `musim` (semi, panas, gugur, dingin). Jika tidak yakin, kembalikan null untuk properti tersebut.";
            
            const payload = {
                contents: [{ parts: [ { text: prompt }, { inline_data: { mime_type: file.type, data: base64ImageData } } ] }],
                generationConfig: { response_mime_type: "application/json" }
            };
            
            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });

                if (!response.ok) {
                    let errorMsg = `Panggilan API gagal: ${response.status}`;
                    try { 
                        const errorBody = await response.json(); 
                        errorMsg += `<br>Pesan: ${errorBody.error.message}`; 
                    } catch (err) { 
                        errorMsg += `<br>Status: ${response.statusText}`; 
                    }
                    throw new Error(errorMsg);
                }

                const result = await response.json();
                
                if (result.candidates?.[0]?.content?.parts?.[0]) {
                    const responseText = result.candidates[0].content.parts[0].text;
                    let data;
                    try { data = JSON.parse(responseText); } catch (err) { throw new Error("Menerima respons JSON yang tidak valid dari AI."); }

                    if (data.detail_latar) {
                        if (data.detail_latar.waktu && Array.from(timeSelect.options).some(o => o.value === data.detail_latar.waktu)) timeSelect.value = data.detail_latar.waktu;
                        if (data.detail_latar.cuaca && Array.from(weatherSelect.options).some(o => o.value === data.detail_latar.cuaca)) weatherSelect.value = data.detail_latar.cuaca;
                        if (data.detail_latar.musim && Array.from(seasonSelect.options).some(o => o.value === data.detail_latar.musim)) seasonSelect.value = data.detail_latar.musim;
                    }

                    if (targetId === 'location') {
                        if (data.deskripsi_detail) locationInput.value = data.deskripsi_detail;
                        showAlert('Deskripsi lokasi detail dan data latar lainnya berhasil diisi.');
                    } else {
                        const targetBlock = document.querySelector(`.character-block[data-character-id="${targetId}"]`);
                        if (targetBlock) {
                            if(data.deskripsi_detail) targetBlock.querySelector('.character-characteristics').value = data.deskripsi_detail;
                            if(data.aksi_utama) targetBlock.querySelector('.character-main-action').value = data.aksi_utama;
                            if(data.emosi && Array.from(targetBlock.querySelector('.character-emotion').options).some(o => o.value === data.emosi)) targetBlock.querySelector('.character-emotion').value = data.emosi;
                            showAlert(`Deskripsi detail, aksi, dan emosi berhasil dibuat untuk karakter yang dipilih.`);
                        } else { showAlert("Karakter target tidak ditemukan."); }
                    }
                } else { throw new Error(result.promptFeedback ? `Permintaan diblokir: ${result.promptFeedback.blockReason}` : "Respons API kosong atau tidak valid."); }
            } catch (error) { console.error("Error:", error); showAlert(`<p>Gagal menghasilkan deskripsi: ${error.message}</p>`); } finally { imageLoader.classList.add('hidden'); generateFromImageBtn.disabled = false; }
        };
        reader.readAsDataURL(file);
    });

    // --- DYNAMIC UI FUNCTIONS ---
    let characters = [];
    const updateAllCharacterDropdowns = () => {
        updateCharacterArray();
        updateDialogCharacterDropdown();
        updateImageTargetDropdown();
    };

    const addCharacter = () => {
        characterCounter++;
        const clone = characterTemplate.content.cloneNode(true);
        const characterBlock = clone.querySelector('.character-block');
        characterBlock.dataset.characterId = characterCounter;
        characterBlock.querySelector('h4').textContent = `Karakter ${characterCounter}`;
        characterBlock.querySelector('.character-name').addEventListener('input', updateAllCharacterDropdowns);
        characterBlock.querySelector('.remove-character-btn').onclick = () => {
            characterBlock.remove();
            updateAllCharacterDropdowns();
        };
        characterInputsContainer.appendChild(clone);
        updateAllCharacterDropdowns();
    };
    
    const updateCharacterArray = () => {
        characters = Array.from(document.querySelectorAll('.character-block')).map(block => ({
            id: block.dataset.characterId,
            name: block.querySelector('.character-name').value.trim() || `Karakter ${block.dataset.characterId}`,
            nationality: block.querySelector('.character-nationality').value.trim(),
            characteristics: block.querySelector('.character-characteristics').value.trim(),
            mainAction: block.querySelector('.character-main-action').value.trim(),
            emotion: block.querySelector('.character-emotion').value
        }));
    };

    const updateDialogCharacterDropdown = () => {
        const selectedValue = dialogCharacterSelect.value;
        dialogCharacterSelect.innerHTML = '';
        if (dialogTypeSelect.value !== "tanpa dialog" && characters.length > 0) {
            dialogCharacterSelect.innerHTML = `<option value="all">Semua Karakter</option>` + characters.map(char => `<option value="${char.id}">${char.name}</option>`).join('');
            dialogCharacterSelect.value = selectedValue || 'all';
        }
        updateDialogContentInputs();
    };
        
    const updateImageTargetDropdown = () => {
        const selectedValue = imageTargetSelect.value;
        imageTargetSelect.innerHTML = '<option value="location">Latar/Lokasi</option>';
        if (characters.length > 0) {
            imageTargetSelect.innerHTML += characters.map(char => `<option value="${char.id}">${char.name}</option>`).join('');
        }
        if (selectedValue && Array.from(imageTargetSelect.options).some(opt => opt.value === selectedValue)) {
            imageTargetSelect.value = selectedValue;
        }
    };

    const updateDialogContentInputs = () => {
        dialogContentContainer.innerHTML = '';
        const dialogType = dialogTypeSelect.value;
        const selectedCharId = dialogCharacterSelect.value;
        if (dialogType === "tanpa dialog") {
            dialogCharacterSection.classList.add('hidden');
            return;
        }
        dialogCharacterSection.classList.remove('hidden');
        const createDialogTextarea = (char) => `<div class="dialog-content-block"><label for="dialogContent-${char.id}" class="block text-gray-700 text-sm font-medium mb-1">Dialog ${char.name}:</label><textarea id="dialogContent-${char.id}" class="w-full dialog-content-textarea" rows="2" placeholder="Tulis dialog..."></textarea></div>`;
        if (selectedCharId === 'all' && characters.length > 0) {
            dialogContentContainer.innerHTML = characters.map(createDialogTextarea).join('');
        } else if (selectedCharId) {
            const selectedChar = characters.find(char => char.id == selectedCharId);
            if (selectedChar) dialogContentContainer.innerHTML = createDialogTextarea(selectedChar);
        }
    };

    // --- MANUAL PROMPT GENERATION ---
    const generatePrompt = () => {
        updateCharacterArray();
        if (characters.length > 0 && characters.some(c => !c.mainAction)) { showAlert("<p>Mohon lengkapi <b>Aksi Utama</b> untuk setiap karakter.</p>"); return; }
        if (!locationInput.value.trim()) { showAlert("<p>Mohon lengkapi <b>Lokasi</b>.</p>"); return; }
        
        const subjectId = characters.map(c => [c.name, c.nationality ? `kewarganegaraan ${c.nationality}` : '', c.characteristics ? `dengan karakteristik: ${c.characteristics}` : '', c.mainAction ? `melakukan aksi: ${c.mainAction}`: '', `dengan emosi ${c.emotion}`].filter(Boolean).join(', '));
        const subjectEn = characters.map(c => [c.name, c.nationality, `with characteristics: ${c.characteristics}`, `performing action: ${c.mainAction}`, `with a ${translatePhrase(c.emotion)} emotion`].filter(Boolean).join(', '));
        
        const finalSubjectId = characters.length > 1 ? `Beberapa karakter: ${subjectId.join('; ')}` : (characters.length > 0 ? subjectId.join('') : 'Tidak ada subjek spesifik');
        const finalSubjectEn = characters.length > 1 ? `Multiple characters: ${subjectEn.join('; ')}` : (characters.length > 0 ? subjectEn.join('') : 'No specific subject');

        const backgroundId = `Berlatar di ${locationInput.value.trim()}, ${timeSelect.value}, cuaca ${weatherSelect.value}, musim ${seasonSelect.value}.`;
        const backgroundEn = `Set in ${locationInput.value.trim()} during the ${translatePhrase(timeSelect.value)}, with ${translatePhrase(weatherSelect.value)} weather in ${translatePhrase(seasonSelect.value)}.`;
        
        const cameraId = `Gaya kamera ${cameraStyleSelect.value}, pergerakan ${cameraMovementSelect.value}, sudut ${cameraAngleSelect.value}, fokus ${cameraFocusSelect.value}, pencahayaan ${lightingSelect.value}, gradasi warna ${colorGradingSelect.value}.`;
        const cameraEn = `Camera style ${translatePhrase(cameraStyleSelect.value)}, ${translatePhrase(cameraMovementSelect.value)} movement, ${translatePhrase(cameraAngleSelect.value)} angle, ${translatePhrase(cameraFocusSelect.value)} focus, ${translatePhrase(lightingSelect.value)} lighting, ${translatePhrase(colorGradingSelect.value)} color grading.`;

        let dialogContentId = '', dialogContentEn = '';
        if (dialogTypeSelect.value !== "tanpa dialog") {
            const allDialogsId = [], allDialogsEn = [];
            document.querySelectorAll('.dialog-content-textarea').forEach(textarea => {
                if (textarea.value.trim()) {
                    const charId = textarea.id.replace('dialogContent-', '');
                    const charName = characters.find(c => c.id == charId)?.name || `Karakter ${charId}`;
                    allDialogsId.push(`${charName} berkata: "${textarea.value.trim()}"`);
                    allDialogsEn.push(`${charName} says: "${textarea.value.trim()}"`);
                }
            });
            if (allDialogsId.length > 0) {
                dialogContentId = ` Isi dialog: ${allDialogsId.join('; ')}.`;
                dialogContentEn = ` Dialogue content: ${allDialogsEn.join('; ')}.`;
            }
        }

        const audioId = `Dialog: ${dialogTypeSelect.value}.${dialogContentId} Mood suara: ${moodSoundSelect.value}. Suara lingkungan: ${environmentSoundInput.value.trim() || 'Tidak ada'}. Musik latar: ${backgroundMusicInput.value.trim() || 'Tidak ada'}.`;
        const audioEn = `Dialogue: ${translatePhrase(dialogTypeSelect.value)}.${dialogContentEn} Sound mood: ${translatePhrase(moodSoundSelect.value)}. Environment sound: ${environmentSoundInput.value.trim() || 'None'}. Background music: ${backgroundMusicInput.value.trim() || 'None'}.`;
        
        const videoSpecsId = `Kualitas video ${videoQualitySelect.value}, durasi ${videoDurationSelect.value}, rasio ${videoRatioSelect.value}.`;
        const videoSpecsEn = `Video quality ${translatePhrase(videoQualitySelect.value)}, ${translatePhrase(videoDurationSelect.value)} duration, ${translatePhrase(videoRatioSelect.value)} aspect ratio.`;
        
        const additionalDetails = additionalDetailsTextarea.value.trim();
        const videoType = videoTypeSelect.value;
        
        promptIdOutput.value = [`${videoType.charAt(0).toUpperCase() + videoType.slice(1)}.`, `Subjek: ${finalSubjectId}.`, backgroundId, cameraId, audioId, videoSpecsId, additionalDetails ? `Detail tambahan: ${additionalDetails}.` : ''].filter(Boolean).join('\n\n');
        promptEnOutput.value = [`A ${translatePhrase(videoType)}.`, `Subject: ${finalSubjectEn}.`, backgroundEn, cameraEn, audioEn, videoSpecsEn, additionalDetails ? `Additional details: ${additionalDetails}.` : ''].filter(Boolean).join('\n\n');
    };

    // --- FORM RESET ---
    const clearFields = () => {
        document.querySelectorAll('input[type="text"], input[type="password"], textarea').forEach(el => { if(el.id !== 'apiKeyInput') el.value = ''; });
        document.querySelectorAll('select').forEach(el => el.selectedIndex = 0);
        characterInputsContainer.innerHTML = ''; 
        characterCounter = 0;
        promptIdOutput.value = "";
        promptEnOutput.value = "";
        imageUpload.value = ''; 
        imagePreviewContainer.classList.add('hidden'); 
        imagePreview.src = '#'; 
        generateFromImageBtn.disabled = true;
        addCharacter();
    };

    // --- EVENT LISTENERS ---
    addCharacterBtn.addEventListener('click', addCharacter);
    generateBtn.addEventListener('click', generatePrompt);
    clearBtn.addEventListener('click', clearFields);
    dialogTypeSelect.addEventListener('change', updateAllCharacterDropdowns);
    dialogCharacterSelect.addEventListener('change', updateDialogContentInputs);
    closeWelcomeBtn.addEventListener('click', () => {
        welcomeModal.style.display = 'none';
    });
    window.onclick = (event) => {
        if (event.target == welcomeModal) welcomeModal.style.display = "none";
        if (event.target == modal) modal.style.display = "none";
    };

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        welcomeModal.style.display = 'flex';
        addCharacter();
    });
    </script>
</body>
</html>